# Next.js Migration - File Mapping Reference

This document shows exactly where each file from your current architecture maps to in the Next.js structure.

---

## Architecture Overview

### Before (Current)
```
packages/
‚îú‚îÄ‚îÄ frontend/           # React + Vite
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ relay/
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts
‚îú‚îÄ‚îÄ backend/            # Express + Lambda
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îî‚îÄ‚îÄ src/handlers/
‚îî‚îÄ‚îÄ graphql-server/     # Apollo Server (KEEP)
```

### After (Target)
```
apps/
‚îî‚îÄ‚îÄ web/               # Next.js 15
    ‚îú‚îÄ‚îÄ app/           # App Router (pages + API routes)
    ‚îú‚îÄ‚îÄ components/    # React components
    ‚îú‚îÄ‚îÄ lib/           # Utilities
    ‚îî‚îÄ‚îÄ next.config.ts
packages/
‚îî‚îÄ‚îÄ graphql-server/    # Apollo Server (UNCHANGED)
```

---

## Detailed File Mappings

### üéØ Configuration Files

| Current | Next.js | Notes |
|---------|---------|-------|
| `frontend/vite.config.ts` | `apps/web/next.config.ts` | Different format, see Phase 0 |
| `frontend/tsconfig.json` | `apps/web/tsconfig.json` | Update for App Router |
| `frontend/vitest.config.ts` | `apps/web/vitest.config.ts` | Keep, adjust paths |
| `frontend/.env.development` | `apps/web/.env.local` | Next.js convention |
| `frontend/.env.production` | `apps/web/.env.production` | Same |
| `frontend/package.json` | `apps/web/package.json` | New dependencies |

---

### üè† Root Application Files

| Current | Next.js | Action |
|---------|---------|--------|
| `frontend/src/main.tsx` | `apps/web/app/layout.tsx` | Root layout |
| `frontend/src/App.tsx` | `apps/web/app/layout.tsx` + route groups | Split into layouts |
| `frontend/src/index.css` | `apps/web/app/globals.css` | Copy styles |
| `frontend/index.html` | Generated by Next.js | Metadata in layout.tsx |

---

### üìÑ Pages / Routes

#### Authentication Pages

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/pages/Login.tsx` | `apps/web/app/(auth)/login/page.tsx` | Server Component | Can be SC |
| `frontend/src/pages/Register.tsx` | `apps/web/app/(auth)/register/page.tsx` | Server Component | Can be SC |
| `frontend/src/pages/ForgotPassword.tsx` | `apps/web/app/(auth)/forgot-password/page.tsx` | Server Component | If exists |

#### Main App Pages

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/pages/Home.tsx` | `apps/web/app/(app)/page.tsx` | Server Component | Feed page |
| `frontend/src/pages/Explore.tsx` | `apps/web/app/(app)/explore/page.tsx` | Server Component | Explore feed |
| `frontend/src/pages/Profile.tsx` | `apps/web/app/(app)/profile/[handle]/page.tsx` | Server Component | Dynamic route |
| `frontend/src/pages/Post.tsx` | `apps/web/app/(app)/post/[postId]/page.tsx` | Server Component | Dynamic route |
| `frontend/src/pages/Create.tsx` | `apps/web/app/(app)/create/page.tsx` | Mix | Form is Client |
| `frontend/src/pages/Notifications.tsx` | `apps/web/app/(app)/notifications/page.tsx` | Server Component | May need client |
| `frontend/src/pages/Messages.tsx` | `apps/web/app/(app)/messages/page.tsx` | Client Component | Real-time |
| `frontend/src/pages/Settings.tsx` | `apps/web/app/(app)/settings/page.tsx` | Mix | Forms are client |

#### User Profile Pages

| Current | Next.js | Notes |
|---------|---------|-------|
| Profile view | `app/(app)/profile/[handle]/page.tsx` | Main profile |
| Profile posts | `app/(app)/profile/[handle]/posts/page.tsx` | Tab (optional) |
| Profile followers | `app/(app)/profile/[handle]/followers/page.tsx` | Tab (optional) |
| Profile following | `app/(app)/profile/[handle]/following/page.tsx` | Tab (optional) |

---

### üß© Components

#### Layout Components

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/components/layout/Sidebar.tsx` | `apps/web/components/layout/Sidebar.tsx` | Client | Uses hooks |
| `frontend/src/components/layout/Header.tsx` | `apps/web/components/layout/Header.tsx` | Client | Interactive |
| `frontend/src/components/layout/Footer.tsx` | `apps/web/components/layout/Footer.tsx` | Server | Can be SC |
| `frontend/src/components/layout/Navigation.tsx` | `apps/web/components/layout/Navigation.tsx` | Client | Uses router |

#### Auth Components

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/components/auth/LoginForm.tsx` | `apps/web/components/auth/LoginForm.tsx` | Client | Has state |
| `frontend/src/components/auth/RegisterForm.tsx` | `apps/web/components/auth/RegisterForm.tsx` | Client | Has state |
| `frontend/src/components/auth/ProtectedRoute.tsx` | Not needed | - | Use middleware |

#### Post Components

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/components/posts/PostCard.tsx` | `apps/web/components/posts/PostCard.tsx` | Mix | Like button is client |
| `frontend/src/components/posts/PostList.tsx` | `apps/web/components/posts/PostList.tsx` | Server | Can be SC |
| `frontend/src/components/posts/CreatePostForm.tsx` | `apps/web/components/posts/CreatePostForm.tsx` | Client | Has state |
| `frontend/src/components/posts/PostActions.tsx` | `apps/web/components/posts/PostActions.tsx` | Client | Interactive |
| `frontend/src/components/posts/CommentList.tsx` | `apps/web/components/posts/CommentList.tsx` | Mix | Split |
| `frontend/src/components/posts/CommentForm.tsx` | `apps/web/components/posts/CommentForm.tsx` | Client | Has state |

#### Profile Components

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/components/profile/ProfileHeader.tsx` | `apps/web/components/profile/ProfileHeader.tsx` | Mix | Follow button client |
| `frontend/src/components/profile/ProfileCard.tsx` | `apps/web/components/profile/ProfileCard.tsx` | Server | Display only |
| `frontend/src/components/profile/EditProfileForm.tsx` | `apps/web/components/profile/EditProfileForm.tsx` | Client | Has state |
| `frontend/src/components/profile/ProfileTabs.tsx` | `apps/web/components/profile/ProfileTabs.tsx` | Client | Interactive |

#### Common/Utility Components

| Current | Next.js | Type | Notes |
|---------|---------|------|-------|
| `frontend/src/components/common/Button.tsx` | `apps/web/components/ui/Button.tsx` | Client | May have onClick |
| `frontend/src/components/common/Input.tsx` | `apps/web/components/ui/Input.tsx` | Client | Form input |
| `frontend/src/components/common/Modal.tsx` | `apps/web/components/ui/Modal.tsx` | Client | Interactive |
| `frontend/src/components/common/LoadingSpinner.tsx` | `apps/web/components/ui/LoadingSpinner.tsx` | Server | Can be SC |
| `frontend/src/components/common/ErrorMessage.tsx` | `apps/web/components/ui/ErrorMessage.tsx` | Server | Can be SC |
| `frontend/src/components/common/Avatar.tsx` | `apps/web/components/ui/Avatar.tsx` | Server | Use Next Image |

---

### üîå API / Backend

#### API Routes (Express ‚Üí Next.js)

| Current | Next.js | Notes |
|---------|---------|-------|
| `backend/server.js` | Not needed | Next.js handles |
| `backend/src/handlers/auth/login.ts` | `apps/web/app/api/auth/login/route.ts` | Route handler |
| `backend/src/handlers/auth/register.ts` | `apps/web/app/api/auth/register/route.ts` | Route handler |
| `backend/src/handlers/auth/logout.ts` | `apps/web/app/api/auth/logout/route.ts` | Route handler |
| `backend/src/handlers/auth/refresh.ts` | `apps/web/app/api/auth/refresh/route.ts` | Route handler |
| `backend/src/handlers/auth/profile.ts` | `apps/web/app/api/auth/profile/route.ts` | Or Server Component |

#### Business Logic (Reuse!)

| Current | Next.js | Notes |
|---------|---------|-------|
| `backend/src/infrastructure/di/Container.ts` | `apps/web/lib/di/container.ts` | Copy, adapt |
| `backend/src/infrastructure/middleware/*` | `apps/web/lib/middleware/*` | Adapt for Next.js |
| All services | Keep in packages | Import from monorepo |

---

### üóÉÔ∏è State Management

| Current | Next.js | Replacement | Notes |
|---------|---------|-------------|-------|
| `frontend/src/stores/authStore.ts` | HTTP-only cookies + middleware | Not needed | Server-side session |
| `frontend/src/stores/uiStore.ts` | `apps/web/lib/store/uiStore.ts` | Keep if needed | Client state only |
| Zustand for client state | Keep for client-only state | Same | Still useful |

---

### üîÑ Data Fetching

#### Relay (Optional - Can Keep or Replace)

| Current | Next.js | Action | Notes |
|---------|---------|--------|-------|
| `frontend/src/relay/RelayEnvironment.ts` | `apps/web/lib/relay/environment.ts` | Copy & adapt | If keeping Relay |
| `frontend/src/relay/queries/*.graphql` | `apps/web/lib/relay/queries/*.graphql` | Copy | Relay files |

#### API Client (Replace with Server Components)

| Current | Next.js | Replacement |
|---------|---------|-------------|
| `frontend/src/api/apiClient.ts` | `apps/web/lib/graphql/client.ts` | GraphQL client |
| `frontend/src/api/auth.ts` | API routes | Server Actions |
| `frontend/src/api/posts.ts` | GraphQL queries | Server Components |
| `frontend/src/api/profile.ts` | GraphQL queries | Server Components |

---

### üõ†Ô∏è Utilities / Libraries

| Current | Next.js | Notes |
|---------|---------|-------|
| `frontend/src/utils/validation.ts` | `apps/web/lib/utils/validation.ts` | Copy |
| `frontend/src/utils/format.ts` | `apps/web/lib/utils/format.ts` | Copy |
| `frontend/src/utils/constants.ts` | `apps/web/lib/constants.ts` | Copy |
| `frontend/src/hooks/useAuth.ts` | Not needed | Use getServerSession() |
| `frontend/src/hooks/useNavigationService.ts` | Not needed | Use next/navigation |
| `frontend/src/hooks/useModal.ts` | `apps/web/lib/hooks/useModal.ts` | Copy if needed |

---

### üß™ Testing

| Current | Next.js | Notes |
|---------|---------|-------|
| `frontend/src/test-setup.ts` | `apps/web/test-setup.ts` | Update for Next.js |
| `frontend/src/**/*.test.tsx` | `apps/web/**/*.test.tsx` | Copy tests |
| `frontend/src/test/utils/*` | `apps/web/test/utils/*` | Copy utilities |
| `frontend/src/mocks/*` | `apps/web/mocks/*` | Copy MSW handlers |

---

### üì¶ Workspace Packages (Keep Unchanged!)

These packages stay in `packages/` and are used by Next.js:

| Package | Used By | Notes |
|---------|---------|-------|
| `packages/shared` | `apps/web` | Types, schemas - import directly |
| `packages/auth-utils` | `apps/web` | JWT utilities - import directly |
| `packages/dal` | `apps/web` | Data access - import directly |
| `packages/aws-utils` | `apps/web` | AWS clients - import directly |
| `packages/graphql-server` | Standalone | Keep running on port 4000 |

---

## Special Files (Next.js Specific)

### New Files to Create

| File | Purpose | Phase |
|------|---------|-------|
| `apps/web/app/layout.tsx` | Root layout | 1 |
| `apps/web/app/globals.css` | Global styles | 1 |
| `apps/web/app/(auth)/layout.tsx` | Auth pages layout | 1 |
| `apps/web/app/(app)/layout.tsx` | Protected pages layout | 1 |
| `apps/web/middleware.ts` | Auth middleware | 2 |
| `apps/web/lib/auth/session.ts` | Session management | 2 |
| `apps/web/lib/auth/cookies.ts` | Cookie helpers | 2 |
| `apps/web/lib/graphql/client.ts` | GraphQL client | 4 |
| `apps/web/app/loading.tsx` | Loading UI | 5 |
| `apps/web/app/error.tsx` | Error boundary | 5 |
| `apps/web/app/not-found.tsx` | 404 page | 5 |
| `apps/web/app/sitemap.ts` | Sitemap generation | 5 |
| `apps/web/app/robots.ts` | Robots.txt | 5 |

---

## Migration Priority Order

### High Priority (Core Functionality)
1. Auth pages (login, register)
2. Auth components (LoginForm, RegisterForm)
3. API routes (auth endpoints)
4. Home feed page
5. Profile page
6. Post components

### Medium Priority (Important Features)
7. Create post page/form
8. Explore page
9. Notifications page
10. Profile edit
11. Layout components

### Low Priority (Nice to Have)
12. Settings page
13. Messages page (if implemented)
14. Utility components
15. Additional pages

---

## Component Type Decision Tree

Use this to decide if a component should be Server or Client:

```
Does component use hooks (useState, useEffect, etc.)?
‚îú‚îÄ YES ‚Üí Client Component (add 'use client')
‚îî‚îÄ NO
    ‚îî‚îÄ Does component have event handlers (onClick, onChange, etc.)?
        ‚îú‚îÄ YES ‚Üí Client Component
        ‚îî‚îÄ NO
            ‚îî‚îÄ Does component only render data?
                ‚îú‚îÄ YES ‚Üí Server Component (default)
                ‚îî‚îÄ NO ‚Üí Consider splitting into server + client
```

### Examples:

**Server Components:**
- `PostCard` (display only, no interactions)
- `ProfileHeader` (display only)
- `PostList` (list rendering)
- Layout wrappers

**Client Components:**
- `LoginForm` (has state)
- `CreatePostForm` (has state)
- `LikeButton` (has onClick)
- `CommentForm` (has state)

**Mixed (Split):**
- `PostCard` ‚Üí `PostCard` (server) + `PostActions` (client)
- `ProfileHeader` ‚Üí `ProfileHeader` (server) + `FollowButton` (client)

---

## Import Path Changes

### Before (Vite)
```typescript
import { Component } from '../components/Component';
import { util } from '../../utils/util';
import { type } from '@social-media-app/shared';
```

### After (Next.js)
```typescript
import { Component } from '@/components/Component';
import { util } from '@/lib/utils/util';
import { type } from '@social-media-app/shared'; // Same
```

### Pattern Replacements

| Old Pattern | New Pattern |
|-------------|-------------|
| `import.meta.env.VITE_*` | `process.env.NEXT_PUBLIC_*` |
| `React.lazy()` | Not needed (automatic) |
| `useNavigate()` | `useRouter()` from 'next/navigation' |
| `<Link to="">` | `<Link href="">` from 'next/link' |
| `<img src="">` | `<Image>` from 'next/image' |

---

## Quick Migration Script

Use this bash script to copy files with proper paths:

```bash
#!/bin/bash
# migrate-component.sh

OLD_PATH="packages/frontend/src/components/$1"
NEW_PATH="apps/web/components/$1"

# Create directory
mkdir -p "$(dirname "$NEW_PATH")"

# Copy file
cp "$OLD_PATH" "$NEW_PATH"

# Add 'use client' if contains hooks
if grep -q "useState\|useEffect\|useRouter" "$NEW_PATH"; then
    sed -i "1i 'use client';\n" "$NEW_PATH"
fi

# Update imports
sed -i "s|from '\.\./|from '@/components/|g" "$NEW_PATH"
sed -i "s|from '\.\./\.\./|from '@/lib/|g" "$NEW_PATH"

echo "Migrated $1"
```

Usage:
```bash
./migrate-component.sh posts/PostCard.tsx
```

---

## Troubleshooting Common Issues

### Issue: "Cannot use import statement outside a module"
**Solution:** Add to `next.config.ts`:
```typescript
transpilePackages: ['@social-media-app/shared', '@social-media-app/dal'],
```

### Issue: "Hooks can only be called inside the body of a function component"
**Solution:** Add `'use client'` to top of file

### Issue: "Cannot access cookies in client component"
**Solution:** Pass cookie data from Server Component or use API route

### Issue: "Image optimization failed"
**Solution:** Add domain to `images.remotePatterns` in `next.config.ts`

### Issue: "Module not found: Can't resolve '@/...'"
**Solution:** Check `tsconfig.json` has `"@/*": ["./*"]` in paths

---

## Verification Commands

```bash
# Check all imports are valid
cd apps/web
npx tsc --noEmit

# Check bundle size
npm run build
du -sh .next

# Find all client components
grep -r "'use client'" apps/web/components

# Find all server components (no 'use client')
find apps/web/components -name "*.tsx" | while read f; do
  grep -q "'use client'" "$f" || echo "$f is Server Component"
done

# Check for old Vite imports
grep -r "import.meta.env" apps/web/
```

---

## Success Criteria Checklist

- [ ] All pages from frontend migrated
- [ ] All components from frontend migrated
- [ ] All API endpoints from backend migrated
- [ ] No TypeScript errors
- [ ] No ESLint errors
- [ ] All tests passing
- [ ] Bundle size acceptable
- [ ] Performance equal or better
- [ ] Feature parity achieved

---

## Need Help?

- Check main migration plan: `NEXTJS_MIGRATION_PLAN.md`
- Check phase-specific checklist: `MIGRATION_CHECKLIST.md`
- Next.js docs: https://nextjs.org/docs
- Next.js migration guide: https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration
